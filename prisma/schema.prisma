generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @map("_id")
  createdAt    DateTime  @default(now()) @map("created_at")
  email        String    @unique
  role         UserRole  @default(CUSTOMER)
  wishlist     Wishlist?
  wishlistId   String?   @db.ObjectId
  cart         Cart?
  cartId       String?   @db.ObjectId
  orders       Order[]
}

enum UserRole {
  CUSTOMER
  ADMIN
}

model Product {
  id                     String     @id @default(auto()) @map("_id") @db.ObjectId
  name                   String
  description            String
  additionalInfo         String?
  priceInCents           Int
  oldPriceInCents        Int?
  discountPercentage     Int?
  images                 String[]   // Cloud URLs
  imagePath              String?    // Primary image for admin compatibility
  filePath               String?    // Product file/document path
  isNew                  Boolean    @default(false)
  isAvailableForPurchase Boolean    @default(true) // Renamed for admin compatibility
  inventory              Int        @default(0)
  category               String?
  collectionIDs          String[]   // Array of collection names for admin compatibility
  collections            CollectionOnProduct[]
  cartItems              CartItem[]
  wishlistItems          WishlistItem[]
  orderItems             OrderItem[]
  createdAt              DateTime   @default(now()) @map("created_at")
  updatedAt              DateTime   @updatedAt @map("updated_at")
  sku                    String     @unique
  tag                    String[]
  weight                 Float?
  dimensions             ProductDimensions?
}

type ProductDimensions {
  length Float
  width  Float
  height Float
}

model Collection {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String
  imagePath   String
  products    CollectionOnProduct[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

// Join table for many-to-many relationship between Collections and Products
model CollectionOnProduct {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  collection  Collection @relation(fields: [collectionId], references: [id])
  collectionId String   @db.ObjectId
  product     Product   @relation(fields: [productId], references: [id])
  productId   String    @db.ObjectId
}

model Cart {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  userId      String    @unique
  user        User      @relation(fields: [userId], references: [id])
  items       CartItem[]
}

model CartItem {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  cart        Cart      @relation(fields: [cartId], references: [id])
  cartId      String    @db.ObjectId
  product     Product   @relation(fields: [productId], references: [id])
  productId   String    @db.ObjectId
  quantity    Int
  color       String
  size        String
}

model Wishlist {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  user        User      @relation(fields: [userId], references: [id])
  userId      String    @unique
  items       WishlistItem[]
}

model WishlistItem {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  wishlist    Wishlist  @relation(fields: [wishlistId], references: [id])
  wishlistId  String    @db.ObjectId
  product     Product   @relation(fields: [productId], references: [id])
  productId   String    @db.ObjectId
}

model Order {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  items       OrderItem[]
  totalPrice  Int
  createdAt   DateTime  @default(now()) @map("created_at")
}

model OrderItem {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  order       Order     @relation(fields: [orderId], references: [id])
  orderId     String    @db.ObjectId
  product     Product   @relation(fields: [productId], references: [id])
  productId   String    @db.ObjectId
  quantity    Int
  price       Int
}